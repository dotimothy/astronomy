<!DOCTYPE html>

<!-- 🌌 Timothy Do's Astrophotography Site! 📷-->
<html>
    <base target="_blank"/>
    <head>
        <title>Timothy's Astrophotography</title>
        <meta charset="utf-8" />
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📷</text></svg>">
        <link href='https://fonts.googleapis.com/css?family=Product+Sans' rel='stylesheet' type='text/css'> 
        <script src="imgNames.js"></script>
    </head>

    <style>
        body {
            background-color: black;
        }
        h1, h2, p {
            color: white;
            font-family: Product Sans;
        }
        h1 { 
            font-size: 3em;
            font-weight: bolder;
        }
        h2 {
            font-size: 2em;
        }
        p {
            font-size: 1.5em;
            font-weight: lighter;
        }
        #gallery {
            display: inline-block;
        }
        .thumbhidden {
            width:14.28%;
            opacity: 0%;
        }
        .thumb {
            width:14.28%;
            animation: fadein 0.5s;
            opacity: 100%;
        }
        .thumb:hover {
            opacity: 50%;
            transition: 0.25s;
        }
        @keyframes fadein {
            0% {opacity: 0%;}
            100% {opacity: 100%;}
        }
        button {
            font-size: 8em;
            background-color: transparent;
            border: none;
            opacity: 100%;
            transition: 0.25s;
            user-select: none;
        }
        button:hover {
            opacity: 50%; 
            transition: 0.25s;
        }
        button:active {
            transform: translateY(10px);
        }
        #imageViewer {
            position: fixed;
            top: 0%; 
            left: 0%;
            width: 100%;
            height: 100%;
            margin: 0; 
            padding: 0; 
            z-index: 1;
            user-select: none;
        }
        #full {
            position: relative;
            width: 100%;
            height: 100%;
            object-fit: cover;
            animation: grow 0.5s;
            transition: 0.25s;
            user-select: none;
            pointer-events: none;
        }
        @keyframes grow {
            0% {
                top: 50%;
                left: 50%;
                width: 0%;
                height: 0%; 
            }
            100% {
                top: 0%;
                left: 0%;
                width: 100%; 
                height: 100%;
            }
        }
        #metadataViewer {
            position: fixed;
            background-color: black;
            width: 100%;
            height: 25%;
            bottom: 0%;
            opacity: 4%;
            z-index: 2;
            line-height: 1.25em;
            transition: 0.25s ease-in;
        }
        #metadataViewer:hover {
            opacity: 90%;
            transition: 0.25s ease-in-out
        }
        #exitViewer {
            position: fixed;
            font-size: 7.5em;
            color: white;
            top: 5%;
            right: 5%;
            opacity: 4%;
            transition: ease-in 0.25s;
            z-index: 2;
        }
        #exitViewer:hover {
            opacity: 100%;
            transition: 0.25s;
        }
        #home {
            position: fixed;
            font-size: 6em;
            bottom: 5%;
            right: 4%;
        }
    </style>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let preload = urlParams.has('preload') && urlParams.get('preload') == 'true';
        let doFullscreen = !isMobileDevice() && (!urlParams.has('fullscreen') || urlParams.get('fullscreen') == 'true');
        let gallery;
        let imageViewer;
        let exitViewer;
        let metadata = {};
        let metadataViewer;
        let revealCounter = 0;
        let revealInterval;
        let madeFullscreen = false;

        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1) && !dev;
        }

        function preloadFulls() {
            for(let i = 0; i < imgNames.length; i++) {
                preloadImage(`./fulls/${imgNames[i]}.jpg`); 
            }
        }

        function preloadImage(url) {
            var img = new Image();
            img.src = url;
        }

        function loadThumbs() {
            for (let i = 0; i < imgNames.length; i++) {
                loadThumb(imgNames[i]);
            }
            document.querySelector('footer').hidden = false;
        }

        function getJSONData(url) {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, false); // `false` makes the request synchronous
            try {
                xhr.send(); // Send the request
                if (xhr.status === 200) {
                return JSON.parse(xhr.responseText); // Parse and return JSON data
                } else {
                console.error('Request failed with status:', xhr.status);
                return null;
                }
            } catch (error) {
                console.error('Error fetching JSON:', error);
                return null;
            }
        }

        function loadMetadata() { 
            for (let i = 0; i < imgNames.length; i++) {
                let metadataPath = `./metadata/${imgNames[i]}.json`;
                metadata[imgNames[i]] = getJSONData(metadataPath);
            }
        }

        function loadThumb(imgName) {
            gallery.innerHTML += `<img onclick='viewFull("${imgName}")' id='${imgName}' src='./thumbs/${imgName}.jpg' class='thumbhidden' alt='${imgName}'/>`;
        }

        function revealThumb(imgName) {
            let img = document.getElementById(imgName);
            img.classList.remove('thumbhidden'); 
            img.classList.add('thumb');
        }

        function revealThumbs() {
            if(revealCounter < imgNames.length) {
                revealThumb(imgNames[revealCounter]);
                revealCounter++;
            } else {
                clearInterval(revealInterval);
            }
        }

        function viewFull(imgName) {
            viewMetadata(imgName);
            exitViewer.hidden = false;
            metadataViewer.hidden = false;
            madeFullscreen = doFullscreen && !document.fullscreenElement;
            fullPath = `./fulls/${imgName}.jpg`;
            if(!preload) {
                preloadImage(fullPath);
            }
            if(madeFullscreen) {
                document.body.requestFullscreen();
            }
            imageViewer.innerHTML += `<img id='full' src='${fullPath}'/>`;
            imageViewer.hidden = false;
        }



        function viewMetadata(imgName) {
            /* Extracting Metadata for Image */
            let imgData = metadata[imgName];
            let cameraModel = imgData['Image Model'];
            let width = imgData['Image ImageWidth'];
            let height = imgData['Image ImageLength'];
            let resolution = width*height/(10**6);
            
            /* Displaying Metadata */
            metadataViewer.innerHTML += `<h2>${imgName}.jpg</h2>`;
            metadataViewer.innerHTML += `<p>📷: ${cameraModel}</p>`;
            metadataViewer.innerHTML += `<p>Resolution: ${width}x${height} (${resolution} MP)</p>`;
            console.log(metadataViewer);
        }

        function goHome() {
            window.location.href = "../index.html";
        }

        function exitView() {
            exitViewer.hidden = true;
            metadataViewer.hidden = true;
            metadataViewer.innerHTML = '';
            let full = document.getElementById('full');
            console.log(full);
            if(full != null) {
                full.style.width = '0%'; 
                full.style.height = '0%';
                if(madeFullscreen) {
                    madeFullscreen = false;
                    document.exitFullscreen();        
                } 
                setTimeout(function() {
                    full.remove();
                    imageViewer.hidden = true;
                },250);
            }
        }
        
        let title;
        let thumbInterval;
        let titleInterval;
        let j = 0;
        let completedTitle = `🌌 Timothy's Astrophotography Gallery!!! 🌌`;
        function fillTitle() {
            if(j == 0 || j == completedTitle.length - 2) {
                title.innerHTML += '🌌';
                j++;
            } else {
                title.innerHTML += completedTitle[j];
            }
            j++;
            if(j == completedTitle.length) {
                clearInterval(titleInterval);
            }

        }

        window.onload = function() {
            if(preload) {
                console.log('Preloading Full Res Images!');
                preloadFulls();
            }
            gallery = document.getElementById('gallery');
            imageViewer = document.getElementById('imageViewer');
            title = document.getElementById('title');
            metadataViewer = document.getElementById('metadataViewer');
            exitViewer = document.getElementById('exitViewer');
            loadThumbs();
            loadMetadata();
            revealInterval = setInterval(revealThumbs,75);
            titleInterval = setInterval(fillTitle,75);
        }

        document.addEventListener('fullscreenchange', function(e) {
            if (!document.fullscreenElement) {
                madeFullscreen = false;
                exitView();
            }
        });


    </script>

    <body>
        <h1 id="title"></h1>
        <div id="gallery"></div>
        <div hidden id="imageViewer">
            <button hidden id="exitViewer" onclick="exitView()">X</button>
            <div hidden id="metadataViewer"></div>
        </div>
    </body>

    <footer hidden>
        <h2>© <a href="https://timothydo.me">Timothy Do</a> 2024. All Rights Reserved.</h2>
        <button id="home" onclick="goHome()">🏠</button>
    </footer>

</html>