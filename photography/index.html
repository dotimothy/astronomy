<!DOCTYPE html>

<!-- Timothy Do's Astrophotography Site!-->
 <!--- Modified by Timothy Do --->
<html>
    <base target="_blank">
    <head>
        <title>Timothy's Astrophotography</title>
        <meta charset="utf-8" />
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∑</text></svg>">
        <link href='https://fonts.googleapis.com/css?family=Product+Sans' rel='stylesheet' type='text/css'> 
        <script src="imgNames.js"></script>
    </head>

    <style>
        body {
            background-color: black;
        }
        h1, h2 {
            color: white;
            font-family: Product Sans;
        }
        h1 { 
            font-size: 3em;
        }
        h2 {
            font-size: 2em;
        }
        #gallery {
            display: inline-block;
        }
        .thumbhidden {
            width:14.28%;
            opacity: 0%;
        }
        .thumb {
            width:14.28%;
            animation: fadein 0.5s;
            opacity: 100%;
        }
        .thumb:hover {
            opacity: 50%;
            transition: 0.25s;
        }
        @keyframes fadein {
            0% {opacity: 0%;}
            100% {opacity: 100%;}
        }
        button {
            font-size: 8em;
            background-color: transparent;
            border: none;
            opacity: 100%;
            transition: 0.25s;
            user-select: none;
        }
        button:hover {
            opacity: 50%; 
            transition: 0.25s;
        }
        button:active {
            transform: translateY(10px);
        }
        #imageviewer {
            position: fixed;
            top: 0%; 
            left: 0%;
            width: 100%;
            height: 100%;
            margin: 0; 
            padding: 0; 
            z-index: 1;
            user-select: none;
        }
        #full {
            position: relative;
            width: 100%;
            height: 100%;
            object-fit: cover;
            animation: grow 0.5s;
            transition: 0.5s;
        }
        @keyframes grow {
            0% {
                top: 50%;
                left: 50%;
                width: 0%;
                height: 0%; 
            }
            100% {
                top: 0%;
                left: 0%;
                width: 100%; 
                height: 100%;
            }
        }
        #exitViewer {
            position: fixed;
            top: 5%;
            right: 5%;
            opacity: 5%;
            transition: 0.25s;
            z-index: 2;
        }
        #exitViewer:hover {
            opacity: 100%;
            transition: 0.25s;
        }
        #home {
            position: fixed;
            bottom: 5%;
            right: 5%;
        }
    </style>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let preload = urlParams.has('preload') && urlParams.get('preload') == 'true';
        let dev = urlParams.has('mode') && urlParams.get('mode') == 'dev';
        let doFullscreen = !isMobileDevice();
        let gallery;
        let imageviewer;
        let revealCounter = 0;
        let revealInterval;
        let madeFullscreen = false;

        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1) && !dev;
        }

        function preloadImages() {
            for(let i = 0; i < imgNames.length; i++) {
                preloadImage(`./fulls/${imgNames[i]}.jpg`); 
            }
        }

        function preloadImage(url) {
            var img = new Image();
            img.src = url;
        }

        function loadImages() {
            for (let i = 0; i < imgNames.length; i++) {
                loadImage(imgNames[i]);
            }
            document.querySelector('footer').hidden = false;
        }

        function loadImage(imgName) {
            gallery.innerHTML += `<img onclick='viewImg("${imgName}")' id='${imgName}' src='./thumbs/${imgName}.jpg' class='thumbhidden' alt='${imgName}'/>`;
        }

        function revealImage(imgName) {
            let img = document.getElementById(imgName);
            img.classList.remove('thumbhidden'); 
            img.classList.add('thumb');
        }

        function revealImages() {
            if(revealCounter < imgNames.length) {
                revealImage(imgNames[revealCounter]);
                revealCounter++;
            } else {
                clearInterval(revealInterval);
            }
        }

        function viewImg(imgName) {
            madeFullscreen = doFullscreen && !document.fullscreenElement;
            if(madeFullscreen) {
                document.body.requestFullscreen();
            }
            imageviewer.innerHTML += `<img id='full' src='./fulls/${imgName}.jpg'/>`;
            imageviewer.hidden = false;
        }

        function goHome() {
            window.location.href = "../index.html";
        }

        function exitViewer() {
            let full = document.getElementById('full');
            console.log(full);
            if(full != null) {
                full.style.width = '0%'; 
                full.style.height = '0%';
                setTimeout(function() {
                    full.remove();
                    imageviewer.hidden = true;
                    if(madeFullscreen) {
                        document.exitFullscreen();
                        madeFullscreen = false;
                    } 
                },500);
            }
        }
        
        window.onload = function() {
            if(preload) {
                console.log('Preloading Full Res Images!');
                preloadImages();
            }
            gallery = document.getElementById('gallery');
            imageviewer = document.getElementById('imageviewer');
            loadImages();
            revealInterval = setInterval(revealImages,75);
        }

        document.addEventListener('keydown', function(e) {
            if (e.key == "Escape") {
                console.log('Escape Key Pressed');
                exitViewer();
            }
        });
    </script>

    <body>
        <h1 id="title">üåå Timothy's Astrophotography Gallery üåå</h1>
        <div id="gallery"></div>
        <div hidden id="imageviewer">
            <button id="exitViewer" onclick="exitViewer()">‚ùå</button>
        </div>
    </body>

    <footer hidden>
        <h2>¬© <a href="https://timothydo.me">Timothy Do</a> 2024. All Rights Reserved.</h2>
        <button id="home" onclick="goHome()">üè†</button>
    </footer>

</html>